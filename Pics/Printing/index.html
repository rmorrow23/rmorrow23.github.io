<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Print Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ZIP extraction -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<!-- HEIC â†’ PNG conversion -->
<script src="https://cdn.jsdelivr.net/npm/heic2any/dist/heic2any.min.js"></script>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #0b0b0b;
    color: #eaeaea;
    padding: 20px;
  }

  h1 {
    margin-top: 0;
  }

  input[type="file"] {
    margin-bottom: 20px;
  }

  button {
    padding: 10px 14px;
    margin: 10px 0;
    background: #1f6feb;
    border: none;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }

  .image-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .image-item {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #161616;
    padding: 10px;
    border-radius: 8px;
  }

  .image-item img {
    width: 80px;
    height: auto;
    border-radius: 6px;
    background: #000;
  }

  .filename {
    flex: 1;
    font-size: 0.9rem;
    word-break: break-all;
  }

  .remaining {
    margin-top: 20px;
    background: #121212;
    padding: 12px;
    border-radius: 8px;
  }
</style>
</head>

<body>

<h1>Image Print Tracker</h1>

<input type="file" id="zipInput" accept=".zip">

<div class="image-list" id="imageList"></div>

<button onclick="showRemaining()">Show Remaining Images To Print</button>

<div class="remaining" id="remainingList" hidden>
  <h3>Remaining Images</h3>
  <ul id="remainingUl"></ul>
</div>

<script>
const zipInput = document.getElementById("zipInput");
const imageList = document.getElementById("imageList");
const remainingList = document.getElementById("remainingList");
const remainingUl = document.getElementById("remainingUl");

let images = [];

zipInput.addEventListener("change", async (e) => {
  imageList.innerHTML = "";
  images = [];

  const file = e.target.files[0];
  if (!file) return;

  const zip = await JSZip.loadAsync(file);

  for (const [filename, entry] of Object.entries(zip.files)) {
    if (entry.dir) continue;

    if (!/\.(png|jpg|jpeg|heic|heif)$/i.test(filename)) continue;

    let blob = await entry.async("blob");

    // Convert HEIC / HEIF â†’ PNG
    if (/\.(heic|heif)$/i.test(filename)) {
      try {
        blob = await heic2any({
          blob,
          toType: "image/png"
        });
      } catch (err) {
        console.error("HEIC conversion failed:", filename, err);
        continue;
      }
    }

    const url = URL.createObjectURL(blob);

    const imageData = {
      filename,
      printed: false
    };
    images.push(imageData);

    const row = document.createElement("div");
    row.className = "image-item";

    const img = document.createElement("img");
    img.src = url;

    const name = document.createElement("div");
    name.className = "filename";
    name.textContent = filename;

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.title = "Printed";
    checkbox.onchange = () => {
      imageData.printed = checkbox.checked;
    };

    row.appendChild(img);
    row.appendChild(name);
    row.appendChild(checkbox);
    imageList.appendChild(row);
  }
});

function showRemaining() {
  remainingUl.innerHTML = "";

  const remaining = images.filter(i => !i.printed);

  if (remaining.length === 0) {
    remainingUl.innerHTML = "<li>All images printed ðŸŽ‰</li>";
  } else {
    remaining.forEach(i => {
      const li = document.createElement("li");
      li.textContent = i.filename;
      remainingUl.appendChild(li);
    });
  }

  remainingList.hidden = false;
}
</script>

</body>
</html>
