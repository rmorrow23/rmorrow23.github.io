<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HCI Recovery Blocks</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: system-ui, sans-serif;
  background: #0f1115;
  color: #fff;
  margin: 0;
  padding: 20px;
}

.container {
  max-width: 520px;
  margin: auto;
  background: #161a22;
  border-radius: 12px;
  padding: 20px;
}

h2 {
  text-align: center;
  margin-bottom: 8px;
}

.progress {
  height: 8px;
  background: #2a2f3a;
  border-radius: 5px;
  overflow: hidden;
  margin-bottom: 15px;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: #d4af37;
}

.circle-wrap {
  display: flex;
  justify-content: center;
  margin: 15px 0;
}

.circle {
  width: 140px;
  height: 140px;
  border-radius: 50%;
  background: conic-gradient(#d4af37 0deg, #2a2f3a 0deg);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.circle span {
  display: none;
  font-size: 22px;
}

.task {
  margin: 10px 0;
}

input[type="checkbox"] {
  transform: scale(1.3);
  margin-right: 10px;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: #d4af37;
  color: #000;
  cursor: pointer;
  opacity: 0.6;
}

button.enabled {
  opacity: 1;
}

.hidden { display: none; }
</style>
</head>

<body>

<div class="container">
  <h2 id="blockTitle"></h2>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div class="circle-wrap">
    <div class="circle" id="focusCircle">
      <span id="focusTime"></span>
    </div>
  </div>

  <button id="startFocus">Start Focus</button>

  <div id="checklist"></div>
</div>

<script>
/* CONFIG */
const blocks = [
  {
    title: "Block 1 â€“ Set A (Discussions)",
    tasks: [
      "Discussion: Ch 1 â€“ Design for a Better World",
      "Reading Review Discussion: HCI Principle #2",
      "Submit both discussions",
      "Message professor with progress update"
    ]
  },
  {
    title: "Block 2 â€“ Set B (Presentations & Inquiry)",
    tasks: [
      "Assignment: Discovery Presentation",
      "Inquiry: Human-Computer Interfaces",
      "Export / proof submissions",
      "Ready to request unlock & submit"
    ]
  },
  {
    title: "Block 3 â€“ Set C (Core Design Build)",
    tasks: [
      "Assignment: Blueprint",
      "Assignment: Prototype",
      "Final review against rubric",
      "Submit immediately after unlock"
    ]
  }
];

const focusMinutes = [75, 75, 90];

/* STATE */
let state = JSON.parse(localStorage.getItem("focusState")) || {
  block: 0,
  checks: []
};

let focusInterval = null;
let showTime = false;

const titleEl = document.getElementById("blockTitle");
const checklist = document.getElementById("checklist");
const progressBar = document.getElementById("progressBar");
const focusCircle = document.getElementById("focusCircle");
const focusTime = document.getElementById("focusTime");

const beep = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=");

focusCircle.onclick = () => {
  showTime = !showTime;
  focusTime.style.display = showTime ? "block" : "none";
};

function save() {
  localStorage.setItem("focusState", JSON.stringify(state));
}

function updateProgress() {
  progressBar.style.width = `${(state.block / blocks.length) * 100}%`;
}

function loadBlock() {
  checklist.innerHTML = "";

  if (state.block >= blocks.length) {
    titleEl.textContent = "All Planned Blocks Complete ðŸŽ‰";
    checklist.innerHTML = "<p style='text-align:center'>Youâ€™re done for this phase.</p>";
    updateProgress();
    return;
  }

  const block = blocks[state.block];
  titleEl.textContent = block.title;

  block.tasks.forEach((task, i) => {
    checklist.innerHTML += `
      <div class="task">
        <label>
          <input type="checkbox" ${state.checks[i] ? "checked" : ""}>
          ${task}
        </label>
      </div>
    `;
  });

  checklist.onchange = () => {
    const checks = [...checklist.querySelectorAll("input")];
    state.checks = checks.map(c => c.checked);
    save();
  };

  updateProgress();
}

document.getElementById("startFocus").onclick = () => {
  let total = focusMinutes[state.block] * 60;
  let seconds = total;

  clearInterval(focusInterval);

  focusInterval = setInterval(() => {
    seconds--;
    const percent = 360 * (1 - seconds / total);
    focusCircle.style.background =
      `conic-gradient(#d4af37 ${percent}deg, #2a2f3a ${percent}deg)`;

    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    focusTime.textContent = `${m}:${s.toString().padStart(2,"0")}`;

    if (seconds <= 0) {
      clearInterval(focusInterval);
      beep.play();
      if (navigator.vibrate) navigator.vibrate(200);
      state.block++;
      state.checks = [];
      save();
      loadBlock();
    }
  }, 1000);
};

loadBlock();
</script>

</body>
</html>
